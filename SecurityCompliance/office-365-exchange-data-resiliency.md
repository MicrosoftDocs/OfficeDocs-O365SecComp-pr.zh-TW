---
title: Office 365 Exchange 資料恢復
ms.author: robmazz
author: robmazz
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
description: Exchange Online 和 Office 365 內的資料復原的各個方面的說明。
ms.openlocfilehash: 9e61efaf95d466fcb268e12317c7feab0701c062
ms.sourcegitcommit: 0017dc6a5f81c165d9dfd88be39a6bb17856582e
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/23/2019
ms.locfileid: "32262755"
---
# <a name="exchange-online-data-resiliency-in-office-365"></a>Office 365 中的 Exchange Online 資料恢復

## <a name="introduction"></a>簡介
有可能會影響 Exchange 資料庫損毀的兩種類型： 實體損毀，通常由 （在特定，儲存硬體） 的硬體問題所造成和邏輯損毀，因為其他因素，就會發生。 一般而言，有兩種類型的邏輯損毀，可以在 Exchange 資料庫中發生： 
- **資料庫邏輯損毀**的資料庫頁面總和檢查碼相符項目，但頁面上的資料是錯誤的邏輯。 這可能會發生當 (可延伸儲存引擎 (ESE)) 的資料庫引擎嘗試寫入資料庫] 頁面上，即使作業系統傳回成功的訊息，將資料或是永遠不會寫入至磁碟，或其寫入錯誤的地方。 這稱為*遺失清除*。 ESE 包含的許多功能和設計可避免實體損毀的資料庫及其他資料遺失案例的防護措施。 若要避免遺失的清除遺失資料，ESE 會包含遺失清除偵測機制以及修正它的功能 （單一頁面還原） 資料庫中。 
- **儲存邏輯損毀**資料是加入、 刪除或以使用者非預期的方式來操作。 這些情況通常是由協力廠商應用程式所造成。 它通常只是因為使用者看起來像損毀而被視為損毀。 Exchange 存放區會將產生邏輯損毀的交易視為一系列有效的 MAPI 作業。 Exchange Online 中的[[就地保留](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds)功能提供保護從儲存邏輯損毀 （因為它可以防止內容被永久刪除使用者或應用程式）。 

Exchange Online 會執行數個一致性檢查上複製的記錄檔記錄檢查與記錄檔重新顯示期間。 這些一致性檢查防止複製系統的實體損毀。 例如，記錄檢查期間沒有驗證記錄檔，並驗證記錄檔中記錄的總和檢查碼符合總和檢查碼在記憶體中產生實體完整性檢查。 此外，被檢查記錄檔的頁首，以確定記錄標頭中所記錄的記錄檔案簽章符合的記錄檔。 在記錄檔重新顯示記錄檔進一步正文審查。 例如，資料庫標頭也會包含記錄簽章可與記錄檔案的簽章，以確保其符合進行比較。 

Exchange Online 中的信箱資料損毀防範達成，使用 Exchange 的原生資料保護，而運用跨多部伺服器和多個資料中心，以及其他應用程式層級複寫恢復策略協助保護資料免於由於損毀或其他原因而遺失的功能。 這些功能包括原生功能由 Microsoft 或 Exchange Online 的應用程式本身，例如：

- [資料可用性群組](https://docs.microsoft.com/exchange/back-up-email)
- 單一位元校正 
- 線上資料庫掃描 
- 遺失清除偵測 
- 單一頁面還原 
- 信箱複寫服務 
- 記錄檔檢查 
- 彈性檔案系統上的部署 

如需有關上述的原生功能的詳細資訊，在上述的超連結，按一下 [，如需詳細資訊以及沒有超連結的項目上的詳細資訊，請參閱下面的。 除了這些原生功能，Exchange Online 也包含資料恢復客戶可以管理功能，例如： 
- [（預設為啟用） 的單一項目復原](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [就地保留和訴訟資料暫留](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [已刪除的項目保留和 Soft-Deleted 信箱 （兩者皆適用預設為啟用）](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a>資料庫可用性群組 
在 Office 365 中的每個信箱資料庫是裝載於[資料庫可用性群組 (DAG)](https://docs.microsoft.com/exchange/back-up-email) ，而複寫到依地理位置不同資料中心的相同區域內。 最常見的設定是在四個資料中心; 的四個資料庫副本不過，有些地區有較少的資料中心 （資料庫已複寫至印度的三個資料中心兩個資料中心中澳洲及 Japan）。 但在所有情況下，每個信箱資料庫都有四個副本散佈於多個資料中心，藉此確保可保護信箱資料會從軟體、 硬體及甚至是資料中心失敗。 

超出下列四個副本，它們的其中三種設定為高可用性。 第四個副本被設定為[延遲的資料庫副本](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies)。 延遲的資料庫副本不是個別的信箱復原或信箱項目復原。 其目的是提供全系統、 災難性的邏輯損毀的極罕見的事件的復原機制。 

七天記錄檔案重新執行延隔時間來設定 Exchange Online 中的延遲的資料庫副本。 此外，Exchange 重新執行延隔時間管理員能夠提供動態記錄檔減少允許自我修復及管理記錄檔案成長的延遲的資料庫副本的延遲副本。 雖然延遲的資料庫副本用於在 Exchange Online 中，務必了解它們不保證的時間點備份。 Exchange Online 中的延遲的資料庫副本具有 （因為自動播放向下），以及將複製的可用性閾值通常約在 90%，因為其中包含延遲的副本的磁碟是由於磁碟故障，成為高度可用的延遲副本遺失期間為其中延遲的資料庫副本重新建立記錄檔的期間重新顯示佇列。 

## <a name="transport-resilience"></a>傳輸恢復能力 
Exchange Online 包含兩個主要傳輸台回復性功能： 陰影備援和 Safety Net。 在傳輸時，陰影備援會保留郵件的備援副本。 成功傳遞郵件之後，Safety Net 會保留郵件的備援副本。 

使用陰影備援時，每個 Exchange Online 的傳輸伺服器會建立該函數會收到之前會認可成功接收郵件的傳送伺服器的每個郵件的複本。 這讓所有的郵件傳輸管線中備援傳輸中。 如果 Exchange Online 會決定原始郵件已傳送的過程中遺失，已重新傳遞郵件的備援副本。 

Safety Net 是與信箱伺服器上的傳輸服務相關聯的傳輸佇列。 此佇列儲存其副本的伺服器成功處理的郵件。 當信箱資料庫或伺服器失敗需要啟動過期資料庫副本的信箱時，安全網佇列中的郵件會自動重新提交給新的主動副本的信箱資料庫。 Safety Net 也是設為備援，藉此消除傳輸為單一失敗點。 它會使用主要 Safety Net 與陰影 Safety Net 的概念移位，其中如果主要 Safety Net 無法使用 12 小時以上，重新提交要求將成為陰影重新提交要求，且郵件重新傳遞從陰影 Safety Net。

從 Safety Net 郵件重新會自動啟動 Microsoft Exchange 複寫服務，可管理 Dag 和信箱的 Active Manager 元件所資料庫副本。 不需要任何手動操作，才能重新提交郵件從 Safety Net。 

## <a name="single-bit-correction"></a>單一位元校正 
ESE 包含的機制，以偵測和解決單一位元 CRC 錯誤 （也稱為單一位元翻轉） 的硬體錯誤結果 （和如此及其所代表實體損毀時）。 發生這些錯誤時，ESE 自動修正它們，並在事件記錄檔中記錄事件。 

## <a name="online-database-scanning"></a>線上資料庫掃描 
線上資料庫掃描 (也稱為*資料庫總和檢查*) 是其中 ESE 用於資料庫一致性檢查讀取每一頁，並檢查] 頁面上損毀的程序。 主要目的是要偵測實體損毀，並可能無法取得偵測到交易作業的遺失的清除。 資料庫掃描時，也會執行後續的存放區損毀的作業。 可以損毀，因為遺漏空間和線上資料庫掃描會尋找並復原遺失的空間。 系統會設計之初每個資料庫完整掃描一次每隔七天。 

## <a name="lost-flush-detection"></a>遺失清除偵測 
遺失的清除發生於磁碟子系統/作業系統傳回為已完成的資料庫寫入作業未實際寫入至磁碟，或寫入錯誤的位置中。 遺失清除事件可以在 [資料庫邏輯損毀，因此若要避免遺失的清除遺失資料，ESE 中所產生的結果包含遺失清除偵測機制。 被動副本會寫入資料庫頁面，則會檢查的被動副本上遺失清除。 如果偵測到遺失的清除時，ESE 可以修復使用頁面修補處理程序的處理序。 

## <a name="single-page-restore"></a>單一頁面還原 
單一頁面還原，也稱為*頁面修補*，是由從狀況良好的複本的正常副本損毀資料庫頁面所取代其中自動程序。 損毀頁面的修復程序取決於主動或被動資料庫副本的是否。 當作用中資料庫副本遇到損毀的頁面時，它可以複製頁面下列其中一個其複本，前提是它會複製頁面是完全最新狀態。 這被透過將頁面要求放入記錄檔資料流，也就是信箱資料庫複寫的基礎。 只要複本遇到頁面要求它的回應是傳送一份網頁要求的資料庫副本。 單一頁面還原也提供非同步通訊機制的使用中的要求] 頁面上的複本，即使目前離線複本。 

時損毀的被動資料庫副本，包括延遲的資料庫副本，因為這些複本永遠都會背後其主動副本，是永遠安全的任何頁面複製至被動副本的主動副本。 被動資料庫副本是由高可用性的性質，因此期間修補程序] 頁面上，記錄檔重新顯示已暫停，但記錄複製仍。 被動資料庫副本會從主動副本擷取一份損毀的頁面，就會等候直到符合的最大必要的記錄產生要求的記錄檔複製和檢查，並再修補程式損毀的頁面。 一旦已補修] 頁面上，會繼續記錄檔重新顯示。 處理程序是相同的延遲的資料庫副本，不同之處在於延遲的資料庫前會重新顯示，都是為了達成 patchable 狀態的所有記錄檔。 

## <a name="mailbox-replication-service"></a>信箱複寫服務 
移動信箱是管理大規模的電子郵件服務的重要部分。 永遠都會有更新的技術，來處理，因此需要宗旨，節流系統，可讓我們來完成這項工作時保留該信箱的工程師的硬體和版本升級透明給使用者 （依照移動確定它們留線上整個程序） 是機碼，並確定的處理程序的比例，調整順利信箱取得更大和更大。 

Exchange 信箱複寫服務 (MRS) 是負責資料庫之間移動信箱。 在移動期間 MRS 會執行一致性檢查信箱內的所有項目。 如果有找到一致性問題，MRS 將會修正問題，或略過損毀的項目，藉此從信箱移除損毀。 

因為 MRS 是 Exchange Online 的元件，我們可以在其程式碼中進行變更，用於地址新表單的損毀未來偵測到的項目。 例如，如果我們會偵測到 MRS 就無法修正的一致性問題，我們可以分析損毀、 變更 MRS 程式碼，並修正不一致 (如果我們了解如何)。 

## <a name="log-file-checks"></a>記錄檔檢查 
所有交易記錄檔產生 Exchange 資料庫所都經歷一致性檢查的多個的表單。 建立記錄檔時，則會寫入位元模式，並再執行一系列的記錄檔寫入是先完成。 這可讓 Exchange Online，以執行一系列的檢查 （遺失的清除、 CRC 和其他檢查） 若要驗證每個記錄檔寫入，並再次以會複寫。 

## <a name="deployment-on-resilient-file-system"></a>彈性檔案系統上的部署 
若要協助避免發生在檔案系統層級的損毀，Exchange Online 正在部署以提供改良的復原功能復原檔案系統 (ReFS) 磁碟分割上。 ReFS 是設計成既更有彈性資料損毀，進而使獲得最大資料可用性和完整性檔案系統在 Windows Server 2012 和更新版本。 ReFS 具體來說，針對改善項目在方式的中繼資料會更新以提供更好的資料保護和減少資料損毀。 它也會使用總和檢查碼來確認檔案資料的完整性並輕鬆地找到並修復確保該資料損毀的中繼資料。 

Exchange Online 利用數個 ReFS 優點： 
- 多個恢復功能資料完整性表示較少的資料損毀事件。 減少的損毀事件意味著較少的不必要的資料庫重新植入。 
- 啟用偵測損毀情況下的，更快速地及多決定性，讓我們修正客戶資料的中繼資料上執行的總和檢查碼之前灰色故障的資料磁碟區上的損毀。
- 專為與極大型資料集 — petabytes 及更大 — 沒有效能的影響
- Exchange Online 使用，例如 BitLocker 加密其他功能的支援。 

Exchange Online 也受益其他 ReFS 功能： 
- **完整性 （完整性資料流）** ReFS 儲存資料，以保護從許多通常會導致資料遺失的常見錯誤的方式。 Office 365 搜尋會使用完整性資料流，以協助早期磁碟損毀偵測與總和檢查碼的檔案內容。 此功能也可減少因 」 裂寫入 」 （時寫入作業未完成由於電源中斷問題等。） 的損毀事件。 
- **可用性 （殘）** -ReFS 排列優先順序資料的可用性。 在過去，檔案系統通常是容易需要離線的修復系統的資料損毀。 雖然罕見，如果沒有發生損毀，ReFS 實作搶救，一種功能，在即時的磁碟區上的命名空間會移除損毀的資料，並確保良好的資料不產生負面影響的非可修復損毀的資料。 套用殘功能和隔離到 Exchange Online 的資料庫磁碟區的資料損毀表示，我們可以防止非受影響資料庫的損毀的磁碟區良好之間損毀及修復動作的時間。 這會增加通常會由這類磁碟損毀問題受到影響的資料庫的可用性。 