---
title: Office 365 Exchange 資料恢復
ms.author: robmazz
author: robmazz
manager: laurawi
audience: ITPro
ms.topic: article
ms.service: O365-seccomp
localization_priority: Normal
search.appverid:
- MET150
ms.collection:
- Strat_O365_IP
- M365-security-compliance
description: Exchange Online 和 Office 365 內的資料復原的各個方面的說明。
ms.openlocfilehash: 9e61efaf95d466fcb268e12317c7feab0701c062
ms.sourcegitcommit: 1261a37c414111f869df5791548a768d853fda60
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 03/30/2019
ms.locfileid: "31004230"
---
# <a name="exchange-online-data-resiliency-in-office-365"></a><span data-ttu-id="9a040-103">Office 365 中的 Exchange Online 資料恢復</span><span class="sxs-lookup"><span data-stu-id="9a040-103">Exchange Online Data Resiliency in Office 365</span></span>

## <a name="introduction"></a><span data-ttu-id="9a040-104">簡介</span><span class="sxs-lookup"><span data-stu-id="9a040-104">Introduction</span></span>
<span data-ttu-id="9a040-105">有可能會影響 Exchange 資料庫損毀的兩種類型： 實體損毀，通常由 （在特定，儲存硬體） 的硬體問題所造成和邏輯損毀，因為其他因素，就會發生。</span><span class="sxs-lookup"><span data-stu-id="9a040-105">There are two types of corruption that can affect an Exchange database: physical corruption, which is typically caused by hardware (in particular, storage hardware) problems, and logical corruption, which occurs due to other factors.</span></span> <span data-ttu-id="9a040-106">一般而言，有兩種類型的邏輯損毀，可以在 Exchange 資料庫中發生：</span><span class="sxs-lookup"><span data-stu-id="9a040-106">Generally, there are two types of logical corruption that can occur within an Exchange database:</span></span> 
- <span data-ttu-id="9a040-107">**資料庫邏輯損毀**的資料庫頁面總和檢查碼相符項目，但頁面上的資料是錯誤的邏輯。</span><span class="sxs-lookup"><span data-stu-id="9a040-107">**Database logical corruption** - The database page checksum matches, but the data on the page is wrong logically.</span></span> <span data-ttu-id="9a040-108">這可能會發生當 (可延伸儲存引擎 (ESE)) 的資料庫引擎嘗試寫入資料庫] 頁面上，即使作業系統傳回成功的訊息，將資料或是永遠不會寫入至磁碟，或其寫入錯誤的地方。</span><span class="sxs-lookup"><span data-stu-id="9a040-108">This can occur when the database engine (the Extensible Storage Engine (ESE)) attempts to write a database page and even though the operating system returns a success message, the data is either never written to the disk or it's written to the wrong place.</span></span> <span data-ttu-id="9a040-109">這稱為*遺失清除*。</span><span class="sxs-lookup"><span data-stu-id="9a040-109">This is referred to as a *lost flush*.</span></span> <span data-ttu-id="9a040-110">ESE 包含的許多功能和設計可避免實體損毀的資料庫及其他資料遺失案例的防護措施。</span><span class="sxs-lookup"><span data-stu-id="9a040-110">ESE includes numerous features and safeguards that are designed to prevent physical corruption of a database and other data loss scenarios.</span></span> <span data-ttu-id="9a040-111">若要避免遺失的清除遺失資料，ESE 會包含遺失清除偵測機制以及修正它的功能 （單一頁面還原） 資料庫中。</span><span class="sxs-lookup"><span data-stu-id="9a040-111">To prevent lost flushes from losing data, ESE includes a lost flush detection mechanism in the database along with a feature (single page restore) to correct it.</span></span> 
- <span data-ttu-id="9a040-112">**儲存邏輯損毀**資料是加入、 刪除或以使用者非預期的方式來操作。</span><span class="sxs-lookup"><span data-stu-id="9a040-112">**Store logical corruption** - Data is added, deleted, or manipulated in a way that the user doesn't expect.</span></span> <span data-ttu-id="9a040-113">這些情況通常是由協力廠商應用程式所造成。</span><span class="sxs-lookup"><span data-stu-id="9a040-113">These cases are generally caused by third-party applications.</span></span> <span data-ttu-id="9a040-114">它通常只是因為使用者看起來像損毀而被視為損毀。</span><span class="sxs-lookup"><span data-stu-id="9a040-114">It's generally only corruption in the sense that the user views it as corruption.</span></span> <span data-ttu-id="9a040-115">Exchange 存放區會將產生邏輯損毀的交易視為一系列有效的 MAPI 作業。</span><span class="sxs-lookup"><span data-stu-id="9a040-115">The Exchange store considers the transaction that produced the logical corruption to be a series of valid MAPI operations.</span></span> <span data-ttu-id="9a040-116">Exchange Online 中的[[就地保留](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds)功能提供保護從儲存邏輯損毀 （因為它可以防止內容被永久刪除使用者或應用程式）。</span><span class="sxs-lookup"><span data-stu-id="9a040-116">The [In-Place Hold](https://docs.microsoft.com/exchange/security-and-compliance/create-or-remove-in-place-holds) features in Exchange Online provides protection from store logical corruption (because it prevents content from being permanently deleted by a user or an application).</span></span> 

<span data-ttu-id="9a040-117">Exchange Online 會執行數個一致性檢查上複製的記錄檔記錄檢查與記錄檔重新顯示期間。</span><span class="sxs-lookup"><span data-stu-id="9a040-117">Exchange Online performs several consistency checks on replicated log files during both log inspection and log replay.</span></span> <span data-ttu-id="9a040-118">這些一致性檢查防止複製系統的實體損毀。</span><span class="sxs-lookup"><span data-stu-id="9a040-118">These consistency checks prevent physical corruption from being replicated by the system.</span></span> <span data-ttu-id="9a040-119">例如，記錄檢查期間沒有驗證記錄檔，並驗證記錄檔中記錄的總和檢查碼符合總和檢查碼在記憶體中產生實體完整性檢查。</span><span class="sxs-lookup"><span data-stu-id="9a040-119">For example, during log inspection, there is a physical integrity check which verifies the log file and validates that the checksum recorded in the log file matches the checksum generated in memory.</span></span> <span data-ttu-id="9a040-120">此外，被檢查記錄檔的頁首，以確定記錄標頭中所記錄的記錄檔案簽章符合的記錄檔。</span><span class="sxs-lookup"><span data-stu-id="9a040-120">In addition, the log file header is examined to make sure the log file signature recorded in the log header matches that of the log file.</span></span> <span data-ttu-id="9a040-121">在記錄檔重新顯示記錄檔進一步正文審查。</span><span class="sxs-lookup"><span data-stu-id="9a040-121">During log replay, the log file undergoes further scrutiny.</span></span> <span data-ttu-id="9a040-122">例如，資料庫標頭也會包含記錄簽章可與記錄檔案的簽章，以確保其符合進行比較。</span><span class="sxs-lookup"><span data-stu-id="9a040-122">For example, the database header also contains the log signature which is compared with the log file's signature to ensure they match.</span></span> 

<span data-ttu-id="9a040-123">Exchange Online 中的信箱資料損毀防範達成，使用 Exchange 的原生資料保護，而運用跨多部伺服器和多個資料中心，以及其他應用程式層級複寫恢復策略協助保護資料免於由於損毀或其他原因而遺失的功能。</span><span class="sxs-lookup"><span data-stu-id="9a040-123">Protection against corruption of mailbox data in Exchange Online is achieved by using Exchange Native Data Protection, a resiliency strategy that leverages application-level replication across multiple servers and multiple datacenters along with other features that help protect data from being lost due to corruption or other reasons.</span></span> <span data-ttu-id="9a040-124">這些功能包括原生功能由 Microsoft 或 Exchange Online 的應用程式本身，例如：</span><span class="sxs-lookup"><span data-stu-id="9a040-124">These features include native features that are managed by Microsoft or the Exchange Online application itself, such as:</span></span>

- [<span data-ttu-id="9a040-125">資料可用性群組</span><span class="sxs-lookup"><span data-stu-id="9a040-125">Data Availability Groups</span></span>](https://docs.microsoft.com/exchange/back-up-email)
- <span data-ttu-id="9a040-126">單一位元校正</span><span class="sxs-lookup"><span data-stu-id="9a040-126">Single Bit Correction</span></span> 
- <span data-ttu-id="9a040-127">線上資料庫掃描</span><span class="sxs-lookup"><span data-stu-id="9a040-127">Online Database Scanning</span></span> 
- <span data-ttu-id="9a040-128">遺失清除偵測</span><span class="sxs-lookup"><span data-stu-id="9a040-128">Lost Flush Detection</span></span> 
- <span data-ttu-id="9a040-129">單一頁面還原</span><span class="sxs-lookup"><span data-stu-id="9a040-129">Single Page Restore</span></span> 
- <span data-ttu-id="9a040-130">信箱複寫服務</span><span class="sxs-lookup"><span data-stu-id="9a040-130">Mailbox Replication Service</span></span> 
- <span data-ttu-id="9a040-131">記錄檔檢查</span><span class="sxs-lookup"><span data-stu-id="9a040-131">Log File Checks</span></span> 
- <span data-ttu-id="9a040-132">彈性檔案系統上的部署</span><span class="sxs-lookup"><span data-stu-id="9a040-132">Deployment on Resilient File System</span></span> 

<span data-ttu-id="9a040-133">如需有關上述的原生功能的詳細資訊，在上述的超連結，按一下 [，如需詳細資訊以及沒有超連結的項目上的詳細資訊，請參閱下面的。</span><span class="sxs-lookup"><span data-stu-id="9a040-133">For more information on the native features listed above, click on the above hyperlinks, and see below for additional information and for details on items without hyperlinks.</span></span> <span data-ttu-id="9a040-134">除了這些原生功能，Exchange Online 也包含資料恢復客戶可以管理功能，例如：</span><span class="sxs-lookup"><span data-stu-id="9a040-134">In addition to these native features, Exchange Online also includes data resiliency features that customers can manage, such as:</span></span> 
- [<span data-ttu-id="9a040-135">（預設為啟用） 的單一項目復原</span><span class="sxs-lookup"><span data-stu-id="9a040-135">Single Item Recovery (enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/manage-user-mailboxes/recover-deleted-messages) 
- [<span data-ttu-id="9a040-136">就地保留和訴訟資料暫留</span><span class="sxs-lookup"><span data-stu-id="9a040-136">In-Place Hold and Litigation Hold</span></span>](https://docs.microsoft.com/exchange/security-and-compliance/in-place-and-litigation-holds) 
- [<span data-ttu-id="9a040-137">已刪除的項目保留和 Soft-Deleted 信箱 （兩者皆適用預設為啟用）</span><span class="sxs-lookup"><span data-stu-id="9a040-137">Deleted Item Retention and Soft-Deleted Mailboxes (both enabled by default)</span></span>](https://docs.microsoft.com/exchange/recipients-in-exchange-online/delete-or-restore-mailboxes) 

## <a name="database-availability-groups"></a><span data-ttu-id="9a040-138">資料庫可用性群組</span><span class="sxs-lookup"><span data-stu-id="9a040-138">Database Availability Groups</span></span> 
<span data-ttu-id="9a040-139">在 Office 365 中的每個信箱資料庫是裝載於[資料庫可用性群組 (DAG)](https://docs.microsoft.com/exchange/back-up-email) ，而複寫到依地理位置不同資料中心的相同區域內。</span><span class="sxs-lookup"><span data-stu-id="9a040-139">Every mailbox database in Office 365 is hosted in a [database availability group (DAG)](https://docs.microsoft.com/exchange/back-up-email) and replicated to geographically-separate datacenters within the same region.</span></span> <span data-ttu-id="9a040-140">最常見的設定是在四個資料中心; 的四個資料庫副本不過，有些地區有較少的資料中心 （資料庫已複寫至印度的三個資料中心兩個資料中心中澳洲及 Japan）。</span><span class="sxs-lookup"><span data-stu-id="9a040-140">The most common configuration is four database copies in four datacenters; however, some regions have fewer datacenters (databases are replicated to three datacenters in India, and two datacenters in Australia and Japan).</span></span> <span data-ttu-id="9a040-141">但在所有情況下，每個信箱資料庫都有四個副本散佈於多個資料中心，藉此確保可保護信箱資料會從軟體、 硬體及甚至是資料中心失敗。</span><span class="sxs-lookup"><span data-stu-id="9a040-141">But in all cases, every mailbox database has four copies that are distributed across multiple datacenters, thereby ensuring that mailbox data is protected from software, hardware, and even datacenter failures.</span></span> 

<span data-ttu-id="9a040-142">超出下列四個副本，它們的其中三種設定為高可用性。</span><span class="sxs-lookup"><span data-stu-id="9a040-142">Out of these four copies, three of them are configured as highly available.</span></span> <span data-ttu-id="9a040-143">第四個副本被設定為[延遲的資料庫副本](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies)。</span><span class="sxs-lookup"><span data-stu-id="9a040-143">The fourth copy is configured as a [lagged database copy](https://docs.microsoft.com/Exchange/high-availability/manage-ha/activate-lagged-db-copies).</span></span> <span data-ttu-id="9a040-144">延遲的資料庫副本不是個別的信箱復原或信箱項目復原。</span><span class="sxs-lookup"><span data-stu-id="9a040-144">The lagged database copy is not intended for individual mailbox recovery or mailbox item recovery.</span></span> <span data-ttu-id="9a040-145">其目的是提供全系統、 災難性的邏輯損毀的極罕見的事件的復原機制。</span><span class="sxs-lookup"><span data-stu-id="9a040-145">Its purpose is to provide a recovery mechanism for the rare event of system-wide, catastrophic logical corruption.</span></span> 

<span data-ttu-id="9a040-146">七天記錄檔案重新執行延隔時間來設定 Exchange Online 中的延遲的資料庫副本。</span><span class="sxs-lookup"><span data-stu-id="9a040-146">Lagged database copies in Exchange Online are configured with a seven-day log file replay lag time.</span></span> <span data-ttu-id="9a040-147">此外，Exchange 重新執行延隔時間管理員能夠提供動態記錄檔減少允許自我修復及管理記錄檔案成長的延遲的資料庫副本的延遲副本。</span><span class="sxs-lookup"><span data-stu-id="9a040-147">In addition, the Exchange Replay Lag Manager is enabled to provide dynamic log file play down for lagged copies to allow lagged database copies to self-repair and manage log file growth.</span></span> <span data-ttu-id="9a040-148">雖然延遲的資料庫副本用於在 Exchange Online 中，務必了解它們不保證的時間點備份。</span><span class="sxs-lookup"><span data-stu-id="9a040-148">Although lagged database copies are used in Exchange Online, it is important to understand that they are not a guaranteed point-in-time backup.</span></span> <span data-ttu-id="9a040-149">Exchange Online 中的延遲的資料庫副本具有 （因為自動播放向下），以及將複製的可用性閾值通常約在 90%，因為其中包含延遲的副本的磁碟是由於磁碟故障，成為高度可用的延遲副本遺失期間為其中延遲的資料庫副本重新建立記錄檔的期間重新顯示佇列。</span><span class="sxs-lookup"><span data-stu-id="9a040-149">Lagged database copies in Exchange Online have an availability threshold, typically around 90%, due to periods where the disk containing a lagged copy is lost due to disk failure, the lagged copy becoming a highly-available copy (due to automatic play down), as well as the periods where the lagged database copy is re-building the log replay queue.</span></span> 

## <a name="transport-resilience"></a><span data-ttu-id="9a040-150">傳輸恢復能力</span><span class="sxs-lookup"><span data-stu-id="9a040-150">Transport Resilience</span></span> 
<span data-ttu-id="9a040-151">Exchange Online 包含兩個主要傳輸台回復性功能： 陰影備援和 Safety Net。</span><span class="sxs-lookup"><span data-stu-id="9a040-151">Exchange Online includes two primary transport resilience features: Shadow Redundancy and Safety Net.</span></span> <span data-ttu-id="9a040-152">在傳輸時，陰影備援會保留郵件的備援副本。</span><span class="sxs-lookup"><span data-stu-id="9a040-152">Shadow Redundancy keeps a redundant copy of a message while it is in transit.</span></span> <span data-ttu-id="9a040-153">成功傳遞郵件之後，Safety Net 會保留郵件的備援副本。</span><span class="sxs-lookup"><span data-stu-id="9a040-153">Safety Net keeps a redundant copy of a message after the message is successfully delivered.</span></span> 

<span data-ttu-id="9a040-154">使用陰影備援時，每個 Exchange Online 的傳輸伺服器會建立該函數會收到之前會認可成功接收郵件的傳送伺服器的每個郵件的複本。</span><span class="sxs-lookup"><span data-stu-id="9a040-154">With Shadow Redundancy, each Exchange Online transport server makes a copy of each messages it receives before it acknowledges successfully receiving the message to the sending server.</span></span> <span data-ttu-id="9a040-155">這讓所有的郵件傳輸管線中備援傳輸中。</span><span class="sxs-lookup"><span data-stu-id="9a040-155">This makes all messages in the transport pipeline redundant while in transit.</span></span> <span data-ttu-id="9a040-156">如果 Exchange Online 會決定原始郵件已傳送的過程中遺失，已重新傳遞郵件的備援副本。</span><span class="sxs-lookup"><span data-stu-id="9a040-156">If Exchange Online determines the original message was lost in transit, a redundant copy of the message is redelivered.</span></span> 

<span data-ttu-id="9a040-157">Safety Net 是與信箱伺服器上的傳輸服務相關聯的傳輸佇列。</span><span class="sxs-lookup"><span data-stu-id="9a040-157">Safety Net is a transport queue that is associated with the Transport service on a Mailbox server.</span></span> <span data-ttu-id="9a040-158">此佇列儲存其副本的伺服器成功處理的郵件。</span><span class="sxs-lookup"><span data-stu-id="9a040-158">This queue stores copies of messages that were successfully processed by the server.</span></span> <span data-ttu-id="9a040-159">當信箱資料庫或伺服器失敗需要啟動過期資料庫副本的信箱時，安全網佇列中的郵件會自動重新提交給新的主動副本的信箱資料庫。</span><span class="sxs-lookup"><span data-stu-id="9a040-159">When a mailbox database or server failure requires activating an out-of-date copy of the mailbox database, messages in the Safety Net queue are automatically resubmitted to the new active copy of the mailbox database.</span></span> <span data-ttu-id="9a040-160">Safety Net 也是設為備援，藉此消除傳輸為單一失敗點。</span><span class="sxs-lookup"><span data-stu-id="9a040-160">Safety Net is also redundant, thereby eliminating transport as a single point of failure.</span></span> <span data-ttu-id="9a040-161">它會使用主要 Safety Net 與陰影 Safety Net 的概念移位，其中如果主要 Safety Net 無法使用 12 小時以上，重新提交要求將成為陰影重新提交要求，且郵件重新傳遞從陰影 Safety Net。</span><span class="sxs-lookup"><span data-stu-id="9a040-161">It uses the concept of a Primary Safety Net and a Shadow Safety Net wherein if the Primary Safety Net is unavailable for more than 12 hours, resubmit requests become shadow resubmit requests, and messages are re-delivered from the Shadow Safety Net.</span></span>

<span data-ttu-id="9a040-162">從 Safety Net 郵件重新會自動啟動 Microsoft Exchange 複寫服務，可管理 Dag 和信箱的 Active Manager 元件所資料庫副本。</span><span class="sxs-lookup"><span data-stu-id="9a040-162">Message resubmissions from Safety Net are automatically initiated by the Active Manager component of the Microsoft Exchange Replication service that manages DAGs and mailbox database copies.</span></span> <span data-ttu-id="9a040-163">不需要任何手動操作，才能重新提交郵件從 Safety Net。</span><span class="sxs-lookup"><span data-stu-id="9a040-163">No manual actions are required to resubmit messages from Safety Net.</span></span> 

## <a name="single-bit-correction"></a><span data-ttu-id="9a040-164">單一位元校正</span><span class="sxs-lookup"><span data-stu-id="9a040-164">Single Bit Correction</span></span> 
<span data-ttu-id="9a040-165">ESE 包含的機制，以偵測和解決單一位元 CRC 錯誤 （也稱為單一位元翻轉） 的硬體錯誤結果 （和如此及其所代表實體損毀時）。</span><span class="sxs-lookup"><span data-stu-id="9a040-165">ESE includes a mechanism to detect and resolve single-bit CRC errors (aka single-bit flips) that are the result of hardware errors (and as such they represent physical corruption).</span></span> <span data-ttu-id="9a040-166">發生這些錯誤時，ESE 自動修正它們，並在事件記錄檔中記錄事件。</span><span class="sxs-lookup"><span data-stu-id="9a040-166">When these errors occur, ESE automatically corrects them and logs an event in the event log.</span></span> 

## <a name="online-database-scanning"></a><span data-ttu-id="9a040-167">線上資料庫掃描</span><span class="sxs-lookup"><span data-stu-id="9a040-167">Online Database Scanning</span></span> 
<span data-ttu-id="9a040-168">線上資料庫掃描 (也稱為*資料庫總和檢查*) 是其中 ESE 用於資料庫一致性檢查讀取每一頁，並檢查] 頁面上損毀的程序。</span><span class="sxs-lookup"><span data-stu-id="9a040-168">Online database scanning (also known as *database checksumming*) is the process where an ESE uses a database consistency checker to read each page and check for page corruption.</span></span> <span data-ttu-id="9a040-169">主要目的是要偵測實體損毀，並可能無法取得偵測到交易作業的遺失的清除。</span><span class="sxs-lookup"><span data-stu-id="9a040-169">The primary purpose is to detect physical corruption and lost flushes that may not be getting detected by transactional operations.</span></span> <span data-ttu-id="9a040-170">資料庫掃描時，也會執行後續的存放區損毀的作業。</span><span class="sxs-lookup"><span data-stu-id="9a040-170">Database scanning also performs post-store crash operations.</span></span> <span data-ttu-id="9a040-171">可以損毀，因為遺漏空間和線上資料庫掃描會尋找並復原遺失的空間。</span><span class="sxs-lookup"><span data-stu-id="9a040-171">Space can be leaked due to crashes, and online database scanning finds and recovers lost space.</span></span> <span data-ttu-id="9a040-172">系統會設計之初每個資料庫完整掃描一次每隔七天。</span><span class="sxs-lookup"><span data-stu-id="9a040-172">The system is designed with the expectation that every database is fully scanned once every seven days.</span></span> 

## <a name="lost-flush-detection"></a><span data-ttu-id="9a040-173">遺失清除偵測</span><span class="sxs-lookup"><span data-stu-id="9a040-173">Lost Flush Detection</span></span> 
<span data-ttu-id="9a040-174">遺失的清除發生於磁碟子系統/作業系統傳回為已完成的資料庫寫入作業未實際寫入至磁碟，或寫入錯誤的位置中。</span><span class="sxs-lookup"><span data-stu-id="9a040-174">A lost flush occurs when a database write operation that the disk subsystem/operating system returned as completed did not actually get written to disk, or was written in the wrong location.</span></span> <span data-ttu-id="9a040-175">遺失清除事件可以在 [資料庫邏輯損毀，因此若要避免遺失的清除遺失資料，ESE 中所產生的結果包含遺失清除偵測機制。</span><span class="sxs-lookup"><span data-stu-id="9a040-175">Lost flush incidents can result in database logical corruption, so to prevent lost flushes from resulting in lost data, ESE includes a lost flush detection mechanism.</span></span> <span data-ttu-id="9a040-176">被動副本會寫入資料庫頁面，則會檢查的被動副本上遺失清除。</span><span class="sxs-lookup"><span data-stu-id="9a040-176">As database pages are written to passive copies, a check is performed for lost flushes on the active copy.</span></span> <span data-ttu-id="9a040-177">如果偵測到遺失的清除時，ESE 可以修復使用頁面修補處理程序的處理序。</span><span class="sxs-lookup"><span data-stu-id="9a040-177">If a lost flush is detected, ESE can repair the process using a page patching process.</span></span> 

## <a name="single-page-restore"></a><span data-ttu-id="9a040-178">單一頁面還原</span><span class="sxs-lookup"><span data-stu-id="9a040-178">Single Page Restore</span></span> 
<span data-ttu-id="9a040-179">單一頁面還原，也稱為*頁面修補*，是由從狀況良好的複本的正常副本損毀資料庫頁面所取代其中自動程序。</span><span class="sxs-lookup"><span data-stu-id="9a040-179">Single page restore, aka *page patching*, is an automatic process where corrupt database pages are replaced by healthy copies from a healthy replica.</span></span> <span data-ttu-id="9a040-180">損毀頁面的修復程序取決於主動或被動資料庫副本的是否。</span><span class="sxs-lookup"><span data-stu-id="9a040-180">The repair process for a corrupt page depends on whether the database copy is active or passive.</span></span> <span data-ttu-id="9a040-181">當作用中資料庫副本遇到損毀的頁面時，它可以複製頁面下列其中一個其複本，前提是它會複製頁面是完全最新狀態。</span><span class="sxs-lookup"><span data-stu-id="9a040-181">When an active database copy encounters a corrupted page, it can copy a page from one of its replicas, provided the page it copies is completely up-to-date.</span></span> <span data-ttu-id="9a040-182">這被透過將頁面要求放入記錄檔資料流，也就是信箱資料庫複寫的基礎。</span><span class="sxs-lookup"><span data-stu-id="9a040-182">This is accomplished by putting a request for the page into the log stream, which is the basis of mailbox database replication.</span></span> <span data-ttu-id="9a040-183">只要複本遇到頁面要求它的回應是傳送一份網頁要求的資料庫副本。</span><span class="sxs-lookup"><span data-stu-id="9a040-183">As soon as a replica encounters the page request it responds by sending a copy of the page to the requesting database copy.</span></span> <span data-ttu-id="9a040-184">單一頁面還原也提供非同步通訊機制的使用中的要求] 頁面上的複本，即使目前離線複本。</span><span class="sxs-lookup"><span data-stu-id="9a040-184">Single page restore also provides an asynchronous communication mechanism for the active to request a page from replicas, even if the replicas are currently offline.</span></span> 

<span data-ttu-id="9a040-185">時損毀的被動資料庫副本，包括延遲的資料庫副本，因為這些複本永遠都會背後其主動副本，是永遠安全的任何頁面複製至被動副本的主動副本。</span><span class="sxs-lookup"><span data-stu-id="9a040-185">In case of corruption in a passive database copy, including a lagged database copy, because these copies are always behind their active copy, it is always safe to copy any page from the active copy to a passive copy.</span></span> <span data-ttu-id="9a040-186">被動資料庫副本是由高可用性的性質，因此期間修補程序] 頁面上，記錄檔重新顯示已暫停，但記錄複製仍。</span><span class="sxs-lookup"><span data-stu-id="9a040-186">A passive database copy is by nature highly available, so during the page patching process, log replaying is suspended, but log copying continues.</span></span> <span data-ttu-id="9a040-187">被動資料庫副本會從主動副本擷取一份損毀的頁面，就會等候直到符合的最大必要的記錄產生要求的記錄檔複製和檢查，並再修補程式損毀的頁面。</span><span class="sxs-lookup"><span data-stu-id="9a040-187">The passive database copy retrieves a copy of the corrupted page from the active copy, waits until the log file which meets the maximum required log generation requirement is copied and inspected, and then patches the corrupt page.</span></span> <span data-ttu-id="9a040-188">一旦已補修] 頁面上，會繼續記錄檔重新顯示。</span><span class="sxs-lookup"><span data-stu-id="9a040-188">Once the page has been patched, log replay resumes.</span></span> <span data-ttu-id="9a040-189">處理程序是相同的延遲的資料庫副本，不同之處在於延遲的資料庫前會重新顯示，都是為了達成 patchable 狀態的所有記錄檔。</span><span class="sxs-lookup"><span data-stu-id="9a040-189">The process is the same for the lagged database copy, except that the lagged database first replays all log files that are necessary to achieve a patchable state.</span></span> 

## <a name="mailbox-replication-service"></a><span data-ttu-id="9a040-190">信箱複寫服務</span><span class="sxs-lookup"><span data-stu-id="9a040-190">Mailbox Replication Service</span></span> 
<span data-ttu-id="9a040-191">移動信箱是管理大規模的電子郵件服務的重要部分。</span><span class="sxs-lookup"><span data-stu-id="9a040-191">Moving mailboxes is a key part of managing a large-scale email service.</span></span> <span data-ttu-id="9a040-192">永遠都會有更新的技術，來處理，因此需要宗旨，節流系統，可讓我們來完成這項工作時保留該信箱的工程師的硬體和版本升級透明給使用者 （依照移動確定它們留線上整個程序） 是機碼，並確定的處理程序的比例，調整順利信箱取得更大和更大。</span><span class="sxs-lookup"><span data-stu-id="9a040-192">There are always updated technologies and hardware and version upgrades to deal with, so having a robust, throttled system that enables our engineers to accomplish this work while keeping the mailbox moves transparent to users (by making sure they stay online throughout the process) is key and making sure that the process scales up gracefully as mailboxes get larger and larger.</span></span> 

<span data-ttu-id="9a040-193">Exchange 信箱複寫服務 (MRS) 是負責資料庫之間移動信箱。</span><span class="sxs-lookup"><span data-stu-id="9a040-193">The Exchange Mailbox Replication Service (MRS) is responsible for moving mailboxes between databases.</span></span> <span data-ttu-id="9a040-194">在移動期間 MRS 會執行一致性檢查信箱內的所有項目。</span><span class="sxs-lookup"><span data-stu-id="9a040-194">During the move, MRS performs a consistency check on all items within the mailbox.</span></span> <span data-ttu-id="9a040-195">如果有找到一致性問題，MRS 將會修正問題，或略過損毀的項目，藉此從信箱移除損毀。</span><span class="sxs-lookup"><span data-stu-id="9a040-195">If a consistency issue is found, MRS will either correct the problem, or skip the corrupted items, thereby removing the corruption from the mailbox.</span></span> 

<span data-ttu-id="9a040-196">因為 MRS 是 Exchange Online 的元件，我們可以在其程式碼中進行變更，用於地址新表單的損毀未來偵測到的項目。</span><span class="sxs-lookup"><span data-stu-id="9a040-196">Because MRS is a component of Exchange Online, we can make changes in its code to address new forms of corruption that are detected in the future.</span></span> <span data-ttu-id="9a040-197">例如，如果我們會偵測到 MRS 就無法修正的一致性問題，我們可以分析損毀、 變更 MRS 程式碼，並修正不一致 (如果我們了解如何)。</span><span class="sxs-lookup"><span data-stu-id="9a040-197">For example, if we detect a consistency issue that MRS is not able to fix, we can analyze the corruption, change the MRS code and correct the inconsistency (if we understand how to).</span></span> 

## <a name="log-file-checks"></a><span data-ttu-id="9a040-198">記錄檔檢查</span><span class="sxs-lookup"><span data-stu-id="9a040-198">Log File Checks</span></span> 
<span data-ttu-id="9a040-199">所有交易記錄檔產生 Exchange 資料庫所都經歷一致性檢查的多個的表單。</span><span class="sxs-lookup"><span data-stu-id="9a040-199">All transaction log files generated by an Exchange database undergo several forms of consistency checks.</span></span> <span data-ttu-id="9a040-200">建立記錄檔時，則會寫入位元模式，並再執行一系列的記錄檔寫入是先完成。</span><span class="sxs-lookup"><span data-stu-id="9a040-200">When a log file is created, the first thing done is a bit pattern is written and then a series of log writes is performed.</span></span> <span data-ttu-id="9a040-201">這可讓 Exchange Online，以執行一系列的檢查 （遺失的清除、 CRC 和其他檢查） 若要驗證每個記錄檔寫入，並再次以會複寫。</span><span class="sxs-lookup"><span data-stu-id="9a040-201">This enables Exchange Online to execute a series of checks (lost flush, CRC and other checks) to validate each log file as it is written, and again as it is replicated.</span></span> 

## <a name="deployment-on-resilient-file-system"></a><span data-ttu-id="9a040-202">彈性檔案系統上的部署</span><span class="sxs-lookup"><span data-stu-id="9a040-202">Deployment on Resilient File System</span></span> 
<span data-ttu-id="9a040-203">若要協助避免發生在檔案系統層級的損毀，Exchange Online 正在部署以提供改良的復原功能復原檔案系統 (ReFS) 磁碟分割上。</span><span class="sxs-lookup"><span data-stu-id="9a040-203">To help prevent corruption from occurring at the file system level, Exchange Online is being deployed on Resilient File System (ReFS) partitions to provide improved recovery capabilities.</span></span> <span data-ttu-id="9a040-204">ReFS 是設計成既更有彈性資料損毀，進而使獲得最大資料可用性和完整性檔案系統在 Windows Server 2012 和更新版本。</span><span class="sxs-lookup"><span data-stu-id="9a040-204">ReFS is a file system in Windows Server 2012 and later that is designed to be more resilient against data corruption thereby maximizing data availability and integrity.</span></span> <span data-ttu-id="9a040-205">ReFS 具體來說，針對改善項目在方式的中繼資料會更新以提供更好的資料保護和減少資料損毀。</span><span class="sxs-lookup"><span data-stu-id="9a040-205">Specifically, ReFS brings improvements in the way that metadata is updated which offers better protection for data and reduces data corruption cases.</span></span> <span data-ttu-id="9a040-206">它也會使用總和檢查碼來確認檔案資料的完整性並輕鬆地找到並修復確保該資料損毀的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="9a040-206">It also uses checksums to verify the integrity of file data and metadata ensuring that data corruption is easily found and repaired.</span></span> 

<span data-ttu-id="9a040-207">Exchange Online 利用數個 ReFS 優點：</span><span class="sxs-lookup"><span data-stu-id="9a040-207">Exchange Online takes advantage of several ReFS benefits:</span></span> 
- <span data-ttu-id="9a040-208">多個恢復功能資料完整性表示較少的資料損毀事件。</span><span class="sxs-lookup"><span data-stu-id="9a040-208">More resiliency in data integrity means fewer data corruption incidents.</span></span> <span data-ttu-id="9a040-209">減少的損毀事件意味著較少的不必要的資料庫重新植入。</span><span class="sxs-lookup"><span data-stu-id="9a040-209">Reducing the number of corruption incidents means fewer unnecessary database reseeds.</span></span> 
- <span data-ttu-id="9a040-210">啟用偵測損毀情況下的，更快速地及多決定性，讓我們修正客戶資料的中繼資料上執行的總和檢查碼之前灰色故障的資料磁碟區上的損毀。</span><span class="sxs-lookup"><span data-stu-id="9a040-210">Checksum running on metadata enabling detections of corruption cases sooner and more deterministically, allowing us to fix customer data corruption before grey failures occur on data volumes.</span></span>
- <span data-ttu-id="9a040-211">專為與極大型資料集 — petabytes 及更大 — 沒有效能的影響</span><span class="sxs-lookup"><span data-stu-id="9a040-211">Designed to work well with extremely large data sets—petabytes and larger—without performance impact</span></span>
- <span data-ttu-id="9a040-212">Exchange Online 使用，例如 BitLocker 加密其他功能的支援。</span><span class="sxs-lookup"><span data-stu-id="9a040-212">Support for other features used by Exchange Online, such as BitLocker encryption.</span></span> 

<span data-ttu-id="9a040-213">Exchange Online 也受益其他 ReFS 功能：</span><span class="sxs-lookup"><span data-stu-id="9a040-213">Exchange Online also benefits from other ReFS features:</span></span> 
- <span data-ttu-id="9a040-214">**完整性 （完整性資料流）** ReFS 儲存資料，以保護從許多通常會導致資料遺失的常見錯誤的方式。</span><span class="sxs-lookup"><span data-stu-id="9a040-214">**Integrity (Integrity Streams)** - ReFS stores data in a way that protects it from many of the common errors that can normally cause data loss.</span></span> <span data-ttu-id="9a040-215">Office 365 搜尋會使用完整性資料流，以協助早期磁碟損毀偵測與總和檢查碼的檔案內容。</span><span class="sxs-lookup"><span data-stu-id="9a040-215">Office 365 Search uses Integrity Streams to help with early disk corruption detection and checksums of file content.</span></span> <span data-ttu-id="9a040-216">此功能也可減少因 」 裂寫入 」 （時寫入作業未完成由於電源中斷問題等。） 的損毀事件。</span><span class="sxs-lookup"><span data-stu-id="9a040-216">The feature also reduces corruption incidents caused by “Torn Writes” (when a write operation does not complete due to power outages, etc.).</span></span> 
- <span data-ttu-id="9a040-217">**可用性 （殘）** -ReFS 排列優先順序資料的可用性。</span><span class="sxs-lookup"><span data-stu-id="9a040-217">**Availability (Salvage)** - ReFS prioritizes the availability of data.</span></span> <span data-ttu-id="9a040-218">在過去，檔案系統通常是容易需要離線的修復系統的資料損毀。</span><span class="sxs-lookup"><span data-stu-id="9a040-218">Historically, file systems were often susceptible to data corruption that would require the system to be taken offline for repair.</span></span> <span data-ttu-id="9a040-219">雖然罕見，如果沒有發生損毀，ReFS 實作搶救，一種功能，在即時的磁碟區上的命名空間會移除損毀的資料，並確保良好的資料不產生負面影響的非可修復損毀的資料。</span><span class="sxs-lookup"><span data-stu-id="9a040-219">Although rare, if corruption does occur, ReFS implements salvage, a feature that removes the corrupt data from the namespace on a live volume and ensures that good data is not adversely affected by non-repairable corrupt data.</span></span> <span data-ttu-id="9a040-220">套用殘功能和隔離到 Exchange Online 的資料庫磁碟區的資料損毀表示，我們可以防止非受影響資料庫的損毀的磁碟區良好之間損毀及修復動作的時間。</span><span class="sxs-lookup"><span data-stu-id="9a040-220">Applying the Salvage feature and isolating data corruption to Exchange Online database volumes means that we can keep non-affected databases on a corrupted volume healthy between the time of corruption and repair action.</span></span> <span data-ttu-id="9a040-221">這會增加通常會由這類磁碟損毀問題受到影響的資料庫的可用性。</span><span class="sxs-lookup"><span data-stu-id="9a040-221">This increases the availability of databases that would normally be affected by such disk corruption issues.</span></span> 